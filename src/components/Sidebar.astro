---
import { getCollection } from "astro:content";

const chapters = (await getCollection("chapters")).sort(
  (a, b) => a.data.chapter_number - b.data.chapter_number,
);

const baseUrl = import.meta.env.BASE_URL;
---

<nav class="space-y-6">
  <!-- Book Title in Sidebar -->
  <div class="mb-8">
    <a href={`${baseUrl}/`.replace(/\/+/g, "/")} class="block">
      <h2 class="nav-title text-center mb-2">अनंतता की शुरुआत</h2>
      <p class="text-sm text-classic-charcoal-light text-center font-medium">डेविड डॉयच</p>
    </a>
    
    <!-- Decorative divider -->
    <div class="w-16 h-0.5 bg-gradient-to-r from-transparent via-classic-gold to-transparent mx-auto mt-4"></div>
  </div>

  <!-- Table of Contents -->
  <div>
    <h3 class="text-lg font-semibold mb-4 text-classic-navy font-serif">विषय-सूची</h3>
    <ul class="space-y-1">
      {
        chapters.map((chapter) => {
          const chapterUrl = `${baseUrl}/${chapter.slug}/`.replace(/^\/\//, "/");
          const isActive = Astro.url.pathname === chapterUrl || Astro.url.pathname === chapterUrl.replace(/\/$/, '');
          
          return (
            <li>
              <a
                href={chapterUrl}
                class:list={[
                  "nav-link block py-2 px-3 rounded-md transition-all duration-200",
                  {
                    "nav-link active": isActive,
                    "text-classic-charcoal-light hover:text-classic-navy-light": !chapter.data.published,
                    "cursor-not-allowed": !chapter.data.published
                  }
                ]}
                aria-current={isActive ? "page" : undefined}
              >
                <span class="text-sm font-medium text-classic-charcoal-light">
                  अध्याय {chapter.data.chapter_number}
                </span>
                <div class="font-medium mt-1">
                  {chapter.data.title}
                </div>
              </a>
            </li>
          );
        })
      }
    </ul>
  </div>
  
  <!-- Footer info -->
  <div class="pt-8 mt-8 border-t border-classic-gold/20">
    <p class="text-xs text-classic-charcoal-light text-center leading-relaxed">
      मूल कृति: "The Beginning of Infinity"<br/>
      Oxford University Press (2011)
    </p>
  </div>
</nav>

